/*! AeroGear JavaScript Library - v2.1.0 - 2015-03-12
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
!function(a,b){function c(a,b,c){if(4!==b.length)throw new k.exception.invalid("invalid aes block size");var d=a.c[c],e=b[0]^d[0],f=b[c?3:1]^d[1],g=b[2]^d[2];b=b[c?1:3]^d[3];var h,i,j,l,m=d.length/4-2,n=4,o=[0,0,0,0];h=a.n[c],a=h[0];var p=h[1],q=h[2],r=h[3],s=h[4];for(l=0;m>l;l++)h=a[e>>>24]^p[f>>16&255]^q[g>>8&255]^r[255&b]^d[n],i=a[f>>>24]^p[g>>16&255]^q[b>>8&255]^r[255&e]^d[n+1],j=a[g>>>24]^p[b>>16&255]^q[e>>8&255]^r[255&f]^d[n+2],b=a[b>>>24]^p[e>>16&255]^q[f>>8&255]^r[255&g]^d[n+3],n+=4,e=h,f=i,g=j;for(l=0;4>l;l++)o[c?3&-l:l]=s[e>>>24]<<24^s[f>>16&255]<<16^s[g>>8&255]<<8^s[255&b]^d[n++],h=e,e=f,f=g,g=b,b=h;return o}function d(a,b){var c,d,e,f=b.slice(0),g=a.u,h=a.c,i=g[0],j=g[1],k=g[2],l=g[3],m=g[4],n=g[5],o=g[6],p=g[7];for(c=0;64>c;c++)16>c?d=f[c]:(d=f[c+1&15],e=f[c+14&15],d=f[15&c]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+f[15&c]+f[c+9&15]|0),d=d+p+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(o^m&(n^o))+h[c],p=o,o=n,n=m,m=l+d|0,l=k,k=j,j=i,i=d+(j&k^l&(j^k))+(j>>>2^j>>>13^j>>>22^j<<30^j<<19^j<<10)|0;g[0]=g[0]+i|0,g[1]=g[1]+j|0,g[2]=g[2]+k|0,g[3]=g[3]+l|0,g[4]=g[4]+m|0,g[5]=g[5]+n|0,g[6]=g[6]+o|0,g[7]=g[7]+p|0}function e(a,b){var c,d=k.random.F[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function f(a){a.c=g(a).concat(g(a)),a.H=new k.cipher.aes(a.c)}function g(a){for(var b=0;4>b&&(a.h[b]=a.h[b]+1|0,!a.h[b]);b++);return a.H.encrypt(a.h)}this.AeroGear={},AeroGear.Core=function(){if(this instanceof AeroGear.Core)throw"Invalid instantiation of base class AeroGear.Core";this.add=function(a){var b,c,d=this[this.collectionName]||{};if(this[this.collectionName]=d,!a)return this;if("string"==typeof a)d[a]=AeroGear[this.lib].adapters[this.type](a,this.config);else if(Array.isArray(a))for(b=0;b<a.length;b++)c=a[b],"string"==typeof c?d[c]=AeroGear[this.lib].adapters[this.type](c,this.config):c.name&&(c.settings=AeroGear.extend(c.settings||{},this.config),d[c.name]=AeroGear[this.lib].adapters[c.type||this.type](c.name,c.settings));else{if(!a.name)return this;a.settings=AeroGear.extend(a.settings||{},this.config),d[a.name]=AeroGear[this.lib].adapters[a.type||this.type](a.name,a.settings)}return this[this.collectionName]=d,this},this.remove=function(a){var b,c,d=this[this.collectionName]||{};if("string"==typeof a)delete d[a];else if(Array.isArray(a))for(b=0;b<a.length;b++)c=a[b],"string"==typeof c?delete d[c]:delete d[c.name];else a&&delete d[a.name];return this[this.collectionName]=d,this}},AeroGear.extend=function(){var a,b,c,d=arguments[0];for(b=1;b<arguments.length;b++){c=arguments[b];for(a in c)d[a]=c[a]}return d},function(){function a(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=p[a])});16>e;)b[d+e++]=0;return b}function b(a,b){var c=b||0,d=o;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function c(a,c,d){var e=c&&d||0,f=c||[];a=a||{};var g=null!=a.clockseq?a.clockseq:t,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:v+1,j=h-u+(i-v)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>u)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=h,v=i,t=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||s,n=0;6>n;n++)f[e+n]=m[n];return c?c:b(f)}function d(a,c,d){var e=c&&d||0;"string"==typeof a&&(c="binary"==a?new n(16):null,a=null),a=a||{};var f=a.random||(a.rng||m)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,c)for(var g=0;16>g;g++)c[e+g]=f[g];return c||b(f)}var e,f,g,h=this,i=new Array(16);if(e=function(){for(var a,a,b=i,c=0,c=0;16>c;c++)0==(3&c)&&(a=4294967296*Math.random()),b[c]=a>>>((3&c)<<3)&255;return b},h.crypto&&crypto.getRandomValues){var j=new Uint32Array(4);g=function(){crypto.getRandomValues(j);for(var a=0;16>a;a++)i[a]=j[a>>2]>>>8*(3&a)&255;return i}}try{var k=require("crypto").randomBytes;f=k&&function(){return k(16)}}catch(l){}for(var m=f||g||e,n="function"==typeof Buffer?Buffer:Array,o=[],p={},q=0;256>q;q++)o[q]=(q+256).toString(16).substr(1),p[o[q]]=q;var r=m(),s=[1|r[0],r[1],r[2],r[3],r[4],r[5]],t=16383&(r[6]<<8|r[7]),u=0,v=0,w=d;w.v1=c,w.v4=d,w.parse=a,w.unparse=b,w.BufferClass=n,w.mathRNG=e,w.nodeRNG=f,w.whatwgRNG=g;var x=h.uuid;w.noConflict=function(){return h.uuid=x,w},h.uuid=w}();var h=void 0,i=!0,j=!1,k={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message},this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message},this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message},this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message},this.message=a}}};"undefined"!=typeof module&&module.exports&&(module.exports=k),k.cipher.aes=function(a){this.n[0][0][0]||this.K();var b,c,d,e,f=this.n[0][4],g=this.n[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new k.exception.invalid("invalid aes key size");for(this.c=[d=a.slice(0),e=[]],a=b;4*b+28>a;a++)c=d[a-1],(0===a%b||8===b&&4===a%b)&&(c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[255&c],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7))),d[a]=d[a-b]^c;for(b=0;a;b++,a--)c=d[3&b?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[255&c]]},k.cipher.aes.prototype={encrypt:function(a){return c(this,a,0)},decrypt:function(a){return c(this,a,1)},n:[[[],[],[],[],[]],[[],[],[],[],[]]],K:function(){var a,b,c,d,e,f,g,h=this.n[0],i=this.n[1],j=h[4],k=i[4],l=[],m=[];for(a=0;256>a;a++)m[(l[a]=a<<1^283*(a>>7))^a]=a;for(b=c=0;!j[b];b^=d||1,c=m[c]||1)for(f=c^c<<1^c<<2^c<<3^c<<4,f=f>>8^255&f^99,j[b]=f,k[f]=b,e=l[a=l[d=l[b]]],g=16843009*e^65537*a^257*d^16843008*b,e=257*l[f]^16843008*f,a=0;4>a;a++)h[a][b]=e=e<<24^e>>>8,i[a][f]=g=g<<24^g>>>8;for(a=0;5>a;a++)h[a]=h[a].slice(0),i[a]=i[a].slice(0)}},k.bitArray={bitSlice:function(a,b,c){return a=k.bitArray.U(a.slice(b/32),32-(31&b)).slice(1),c===h?a:k.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return(-32&(b+c-1^b)?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=k.bitArray.getPartial(c);return 32===d?a.concat(b):k.bitArray.U(b,d,0|c,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+k.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;return b&=31,c>0&&b&&(a[c-1]=k.bitArray.partial(b,a[c-1]&2147483648>>b-1,1)),a},partial:function(a,b,c){return 32===a?b:(c?0|b:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(k.bitArray.bitLength(a)!==k.bitArray.bitLength(b))return j;var c,d=0;for(c=0;c<a.length;c++)d|=a[c]^b[c];return 0===d},U:function(a,b,c,d){var e;for(e=0,d===h&&(d=[]);b>=32;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;return e=a.length?a[a.length-1]:0,a=k.bitArray.getPartial(e),d.push(k.bitArray.partial(b+a&31,b+a>32?c:d.pop(),1)),d},ba:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}},k.codec.utf8String={fromBits:function(a){var b,c,d="",e=k.bitArray.bitLength(a);for(b=0;e/8>b;b++)0===(3&b)&&(c=a[b/4]),d+=String.fromCharCode(c>>>24),c<<=8;return decodeURIComponent(escape(d))},toBits:function(a){a=unescape(encodeURIComponent(a));var b,c=[],d=0;for(b=0;b<a.length;b++)d=d<<8|a.charCodeAt(b),3===(3&b)&&(c.push(d),d=0);return 3&b&&c.push(k.bitArray.partial(8*(3&b),d)),c}},k.codec.hex={fromBits:function(a){var b,c="";for(b=0;b<a.length;b++)c+=((0|a[b])+0xf00000000000).toString(16).substr(4);return c.substr(0,k.bitArray.bitLength(a)/4)},toBits:function(a){var b,c,d=[];for(a=a.replace(/\s|0x/g,""),c=a.length,a+="00000000",b=0;b<a.length;b+=8)d.push(0^parseInt(a.substr(b,8),16));return k.bitArray.clamp(d,4*c)}},k.hash.sha256=function(a){this.c[0]||this.K(),a?(this.u=a.u.slice(0),this.p=a.p.slice(0),this.k=a.k):this.reset()},k.hash.sha256.hash=function(a){return(new k.hash.sha256).update(a).finalize()},k.hash.sha256.prototype={blockSize:512,reset:function(){return this.u=this.R.slice(0),this.p=[],this.k=0,this},update:function(a){"string"==typeof a&&(a=k.codec.utf8String.toBits(a));var b,c=this.p=k.bitArray.concat(this.p,a);for(b=this.k,a=this.k=b+k.bitArray.bitLength(a),b=512+b&-512;a>=b;b+=512)d(this,c.splice(0,16));return this},finalize:function(){var a,b=this.p,c=this.u,b=k.bitArray.concat(b,[k.bitArray.partial(1,1)]);for(a=b.length+2;15&a;a++)b.push(0);for(b.push(Math.floor(this.k/4294967296)),b.push(0|this.k);b.length;)d(this,b.splice(0,16));return this.reset(),c},R:[],c:[],K:function(){function a(a){return 4294967296*(a-Math.floor(a))|0}var b,c=0,d=2;a:for(;64>c;d++){for(b=2;d>=b*b;b++)if(0===d%b)continue a;8>c&&(this.R[c]=a(Math.pow(d,.5))),this.c[c]=a(Math.pow(d,1/3)),c++}}},k.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);return b=k.bitArray,d=d||[],a=k.mode.gcm.O(i,a,f,d,c,e||128),b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=k.bitArray,h=g.bitLength(f);if(e=e||128,d=d||[],h>=e?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]),a=k.mode.gcm.O(j,a,f,d,c,e),!g.equal(a.tag,b))throw new k.exception.corrupt("gcm: tag doesn't match");return a.data},aa:function(a,b){var c,d,e,f,g,h=k.bitArray.ba;for(e=[0,0,0,0],f=b.slice(0),c=0;128>c;c++){for((d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f)),g=0!==(1&f[3]),d=3;d>0;d--)f[d]=f[d]>>>1|(1&f[d-1])<<31;f[0]>>>=1,g&&(f[0]^=-520093696)}return e},j:function(a,b,c){var d,e=c.length;for(b=b.slice(0),d=0;e>d;d+=4)b[0]^=4294967295&c[d],b[1]^=4294967295&c[d+1],b[2]^=4294967295&c[d+2],b[3]^=4294967295&c[d+3],b=k.mode.gcm.aa(b,a);return b},O:function(a,b,c,d,e,f){var g,h,i,j,l,m,n,o,p=k.bitArray;for(m=c.length,n=p.bitLength(c),o=p.bitLength(d),h=p.bitLength(e),g=b.encrypt([0,0,0,0]),96===h?(e=e.slice(0),e=p.concat(e,[1])):(e=k.mode.gcm.j(g,[0,0,0,0],e),e=k.mode.gcm.j(g,e,[0,0,Math.floor(h/4294967296),4294967295&h])),h=k.mode.gcm.j(g,[0,0,0,0],d),l=e.slice(0),d=h.slice(0),a||(d=k.mode.gcm.j(g,h,c)),j=0;m>j;j+=4)l[3]++,i=b.encrypt(l),c[j]^=i[0],c[j+1]^=i[1],c[j+2]^=i[2],c[j+3]^=i[3];return c=p.clamp(c,n),a&&(d=k.mode.gcm.j(g,h,c)),a=[Math.floor(o/4294967296),4294967295&o,Math.floor(n/4294967296),4294967295&n],d=k.mode.gcm.j(g,d,a),i=b.encrypt(e),d[0]^=i[0],d[1]^=i[1],d[2]^=i[2],d[3]^=i[3],{tag:p.bitSlice(d,0,f),data:c}}},k.misc.hmac=function(a,b){this.Q=b=b||k.hash.sha256;var c,d=[[],[]],e=b.prototype.blockSize/32;for(this.q=[new b,new b],a.length>e&&(a=b.hash(a)),c=0;e>c;c++)d[0][c]=909522486^a[c],d[1][c]=1549556828^a[c];this.q[0].update(d[0]),this.q[1].update(d[1])},k.misc.hmac.prototype.encrypt=k.misc.hmac.prototype.mac=function(a){return a=new this.Q(this.q[0]).update(a).finalize(),new this.Q(this.q[1]).update(a).finalize()},k.misc.pbkdf2=function(a,b,c,d,e){if(c=c||1e3,0>d||0>c)throw k.exception.invalid("invalid params to pbkdf2");"string"==typeof a&&(a=k.codec.utf8String.toBits(a)),"string"==typeof b&&(b=k.codec.utf8String.toBits(b)),e=e||k.misc.hmac,a=new e(a);var f,g,h,i,j=[],l=k.bitArray;for(i=1;32*j.length<(d||1);i++){for(e=f=a.encrypt(l.concat(b,[i])),g=1;c>g;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];j=j.concat(e)}return d&&(j=l.clamp(j,d)),j},k.prng=function(a){this.e=[new k.hash.sha256],this.l=[0],this.L=0,this.B={},this.J=0,this.N={},this.T=this.g=this.m=this.$=0,this.c=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.H=h,this.I=a,this.s=j,this.F={progress:{},seeded:{}},this.o=this.Z=0,this.C=1,this.D=2,this.X=65536,this.M=[0,48,64,96,128,192,256,384,512,768,1024],this.Y=3e4,this.W=80},k.prng.prototype={randomWords:function(a,b){var c,d=[];c=this.isReady(b);var e;if(c===this.o)throw new k.exception.notReady("generator isn't seeded");if(c&this.D){c=!(c&this.C),e=[];var h,i=0;for(this.T=e[0]=(new Date).valueOf()+this.Y,h=0;16>h;h++)e.push(4294967296*Math.random()|0);for(h=0;h<this.e.length&&(e=e.concat(this.e[h].finalize()),i+=this.l[h],this.l[h]=0,!(!c&&this.L&1<<h));h++);for(this.L>=1<<this.e.length&&(this.e.push(new k.hash.sha256),this.l.push(0)),this.g-=i,i>this.m&&(this.m=i),this.L++,this.c=k.hash.sha256.hash(this.c.concat(e)),this.H=new k.cipher.aes(this.c),c=0;4>c&&(this.h[c]=this.h[c]+1|0,!this.h[c]);c++);}for(c=0;a>c;c+=4)0===(c+1)%this.X&&f(this),e=g(this),d.push(e[0],e[1],e[2],e[3]);return f(this),d.slice(0,a)},setDefaultParanoia:function(a){this.I=a},addEntropy:function(a,b,c){c=c||"user";var d,f,g=(new Date).valueOf(),i=this.B[c],j=this.isReady(),l=0;switch(d=this.N[c],d===h&&(d=this.N[c]=this.$++),i===h&&(i=this.B[c]=0),this.B[c]=(this.B[c]+1)%this.e.length,typeof a){case"number":b===h&&(b=1),this.e[i].update([d,this.J++,1,b,g,1,0|a]);break;case"object":if(c=Object.prototype.toString.call(a),"[object Uint32Array]"===c){for(f=[],c=0;c<a.length;c++)f.push(a[c]);a=f}else for("[object Array]"!==c&&(l=1),c=0;c<a.length&&!l;c++)"number"!=typeof a[c]&&(l=1);if(!l){if(b===h)for(c=b=0;c<a.length;c++)for(f=a[c];f>0;)b++,f>>>=1;this.e[i].update([d,this.J++,2,b,g,a.length].concat(a))}break;case"string":b===h&&(b=a.length),this.e[i].update([d,this.J++,3,b,g,a.length]),this.e[i].update(a);break;default:l=1}if(l)throw new k.exception.bug("random: addEntropy only supports number, array of numbers or string");this.l[i]+=b,this.g+=b,j===this.o&&(this.isReady()!==this.o&&e("seeded",Math.max(this.m,this.g)),e("progress",this.getProgress()))},isReady:function(a){return a=this.M[a!==h?a:this.I],this.m&&this.m>=a?this.l[0]>this.W&&(new Date).valueOf()>this.T?this.D|this.C:this.C:this.g>=a?this.D|this.o:this.o},getProgress:function(a){return a=this.M[a?a:this.I],this.m>=a?1:this.g>a?1:this.g/a},startCollectors:function(){if(!this.s){if(a.addEventListener)a.addEventListener("load",this.v,j),a.addEventListener("mousemove",this.w,j);else{if(!document.attachEvent)throw new k.exception.bug("can't attach event");document.attachEvent("onload",this.v),document.attachEvent("onmousemove",this.w)}this.s=i}},stopCollectors:function(){this.s&&(a.removeEventListener?(a.removeEventListener("load",this.v,j),a.removeEventListener("mousemove",this.w,j)):a.detachEvent&&(a.detachEvent("onload",this.v),a.detachEvent("onmousemove",this.w)),this.s=j)},addEventListener:function(a,b){this.F[a][this.Z++]=b},removeEventListener:function(a,b){var c,d,e=this.F[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},w:function(a){k.random.addEntropy([a.x||a.clientX||a.offsetX||0,a.y||a.clientY||a.offsetY||0],2,"mouse")},v:function(){k.random.addEntropy((new Date).valueOf(),2,"loadtime")}},k.random=new k.prng(6);try{if("undefined"!=typeof module&&module.exports){var l=require("crypto").randomBytes(128);k.random.addEntropy(l,1024,"crypto['randomBytes']")}else if(a&&a.crypto&&a.crypto.getRandomValues){var m=new Uint32Array(32);a.crypto.getRandomValues(m),k.random.addEntropy(m,1024,"crypto['getRandomValues']")}}catch(n){}k.bn=function(a){this.initWith(a)},k.bn.prototype={radix:24,maxMul:8,d:k.bn,copy:function(){return new this.d(this)},initWith:function(a){var b,c=0;switch(typeof a){case"object":this.limbs=a.limbs.slice(0);break;case"number":this.limbs=[a],this.normalize();break;case"string":for(a=a.replace(/^0x/,""),this.limbs=[],b=this.radix/4,c=0;c<a.length;c+=b)this.limbs.push(parseInt(a.substring(Math.max(a.length-c-b,0),a.length-c),16));break;default:this.limbs=[0]}return this},equals:function(a){"number"==typeof a&&(a=new this.d(a));var b,c=0;for(this.fullReduce(),a.fullReduce(),b=0;b<this.limbs.length||b<a.limbs.length;b++)c|=this.getLimb(b)^a.getLimb(b);return 0===c},getLimb:function(a){return a>=this.limbs.length?0:this.limbs[a]},greaterEquals:function(a){"number"==typeof a&&(a=new this.d(a));var b,c,d,e=0,f=0;for(b=Math.max(this.limbs.length,a.limbs.length)-1;b>=0;b--)c=this.getLimb(b),d=a.getLimb(b),f|=d-c&~e,e|=c-d&~f;return(f|~e)>>>31},toString:function(){this.fullReduce();var a,b,c="",d=this.limbs;for(a=0;a<this.limbs.length;a++){for(b=d[a].toString(16);a<this.limbs.length-1&&6>b.length;)b="0"+b;c=b+c}return"0x"+c},addM:function(a){"object"!=typeof a&&(a=new this.d(a));var b=this.limbs,c=a.limbs;for(a=b.length;a<c.length;a++)b[a]=0;for(a=0;a<c.length;a++)b[a]+=c[a];return this},doubleM:function(){var a,b,c=0,d=this.radix,e=this.radixMask,f=this.limbs;for(a=0;a<f.length;a++)b=f[a],b=b+b+c,f[a]=b&e,c=b>>d;return c&&f.push(c),this},halveM:function(){var a,b,c=0,d=this.radix,e=this.limbs;for(a=e.length-1;a>=0;a--)b=e[a],e[a]=b+c>>1,c=(1&b)<<d;return e[e.length-1]||e.pop(),this},subM:function(a){"object"!=typeof a&&(a=new this.d(a));var b=this.limbs,c=a.limbs;for(a=b.length;a<c.length;a++)b[a]=0;for(a=0;a<c.length;a++)b[a]-=c[a];return this},mod:function(a){var b=!this.greaterEquals(new k.bn(0));a=new k.bn(a).normalize();var c=new k.bn(this).normalize(),d=0;for(b&&(c=new k.bn(0).subM(c).normalize());c.greaterEquals(a);d++)a.doubleM();for(b&&(c=a.sub(c).normalize());d>0;d--)a.halveM(),c.greaterEquals(a)&&c.subM(a).normalize();return c.trim()},inverseMod:function(a){var b,c=new k.bn(1),d=new k.bn(0),e=new k.bn(this),f=new k.bn(a),g=1;if(!(1&a.limbs[0]))throw new k.exception.invalid("inverseMod: p must be odd");do for(1&e.limbs[0]&&(e.greaterEquals(f)||(b=e,e=f,f=b,b=c,c=d,d=b),e.subM(f),e.normalize(),c.greaterEquals(d)||c.addM(a),c.subM(d)),e.halveM(),1&c.limbs[0]&&c.addM(a),c.normalize(),c.halveM(),b=g=0;b<e.limbs.length;b++)g|=e.limbs[b];while(g);if(!f.equals(1))throw new k.exception.invalid("inverseMod: p and x must be relatively prime");return d},add:function(a){return this.copy().addM(a)},sub:function(a){return this.copy().subM(a)},mul:function(a){"number"==typeof a&&(a=new this.d(a));var b,c,d=this.limbs,e=a.limbs,f=d.length,g=e.length,h=new this.d,i=h.limbs,j=this.maxMul;for(b=0;b<this.limbs.length+a.limbs.length+1;b++)i[b]=0;for(b=0;f>b;b++){for(c=d[b],a=0;g>a;a++)i[b+a]+=c*e[a];--j||(j=this.maxMul,h.cnormalize())}return h.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(a){"number"==typeof a?a=[a]:a.limbs!==h&&(a=a.normalize().limbs);var b,c,d=new this.d(1),e=this;for(b=0;b<a.length;b++)for(c=0;c<this.radix;c++)a[b]&1<<c&&(d=d.mul(e)),e=e.square();return d},mulmod:function(a,b){return this.mod(b).mul(a.mod(b)).mod(b)},powermod:function(a,b){for(var c=new k.bn(1),d=new k.bn(this),e=new k.bn(a);1&e.limbs[0]&&(c=c.mulmod(d,b)),e.halveM(),!e.equals(0);)d=d.mulmod(d,b);return c.normalize().reduce()},trim:function(){var a,b=this.limbs;do a=b.pop();while(b.length&&0===a);return b.push(a),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var a,b,c=0,d=this.ipv,e=this.limbs,f=e.length,g=this.radixMask;for(a=0;f>a||0!==c&&-1!==c;a++)c=(e[a]||0)+c,b=e[a]=c&g,c=(c-b)*d;return-1===c&&(e[a-1]-=this.placeVal),this},cnormalize:function(){var a,b,c=0,d=this.ipv,e=this.limbs,f=e.length,g=this.radixMask;for(a=0;f-1>a;a++)c=e[a]+c,b=e[a]=c&g,c=(c-b)*d;return e[a]+=c,this},toBits:function(a){this.fullReduce(),a=a||this.exponent||this.bitLength();var b=Math.floor((a-1)/24),c=k.bitArray,d=[c.partial((a+7&-8)%this.radix||this.radix,this.getLimb(b))];for(b--;b>=0;b--)d=c.concat(d,[c.partial(Math.min(this.radix,a),this.getLimb(b))]),a-=this.radix;return d},bitLength:function(){this.fullReduce();for(var a=this.radix*(this.limbs.length-1),b=this.limbs[this.limbs.length-1];b;b>>>=1)a++;return a+7&-8}},k.bn.fromBits=function(a){var b=new this,c=[],d=k.bitArray,e=this.prototype,f=Math.min(this.bitLength||4294967296,d.bitLength(a)),g=f%e.radix||e.radix;for(c[0]=d.extract(a,0,g);f>g;g+=e.radix)c.unshift(d.extract(a,g,e.radix));return b.limbs=c,b},k.bn.prototype.ipv=1/(k.bn.prototype.placeVal=Math.pow(2,k.bn.prototype.radix)),k.bn.prototype.radixMask=(1<<k.bn.prototype.radix)-1,k.bn.pseudoMersennePrime=function(a,b){function c(a){this.initWith(a)}var d,e,f=c.prototype=new k.bn;for(d=f.modOffset=Math.ceil(e=a/f.radix),f.exponent=a,f.offset=[],f.factor=[],f.minOffset=d,f.fullMask=0,f.fullOffset=[],f.fullFactor=[],f.modulus=c.modulus=new k.bn(Math.pow(2,a)),f.fullMask=0|-Math.pow(2,a%f.radix),d=0;d<b.length;d++)f.offset[d]=Math.floor(b[d][0]/f.radix-e),f.fullOffset[d]=Math.ceil(b[d][0]/f.radix-e),f.factor[d]=b[d][1]*Math.pow(.5,a-b[d][0]+f.offset[d]*f.radix),f.fullFactor[d]=b[d][1]*Math.pow(.5,a-b[d][0]+f.fullOffset[d]*f.radix),f.modulus.addM(new k.bn(Math.pow(2,b[d][0])*b[d][1])),f.minOffset=Math.min(f.minOffset,-f.offset[d]);return f.d=c,f.modulus.cnormalize(),f.reduce=function(){var a,b,c,d,e=this.modOffset,f=this.limbs,g=this.offset,h=this.offset.length,i=this.factor;for(a=this.minOffset;f.length>e;){for(c=f.pop(),d=f.length,b=0;h>b;b++)f[d+g[b]]-=i[b]*c;a--,a||(f.push(0),this.cnormalize(),a=this.minOffset)}return this.cnormalize(),this},f.V=-1===f.fullMask?f.reduce:function(){var a,b,c=this.limbs,d=c.length-1;if(this.reduce(),d===this.modOffset-1){for(b=c[d]&this.fullMask,c[d]-=b,a=0;a<this.fullOffset.length;a++)c[d+this.fullOffset[a]]-=this.fullFactor[a]*b;this.normalize()}},f.fullReduce=function(){var a,b;for(this.V(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this.V(),b=this.limbs.length;b<this.modOffset;b++)this.limbs[b]=0;for(a=this.greaterEquals(this.modulus),b=0;b<this.limbs.length;b++)this.limbs[b]-=this.modulus.limbs[b]*a;return this.cnormalize(),this},f.inverse=function(){return this.power(this.modulus.sub(2))},c.fromBits=k.bn.fromBits,c};var o=k.bn.pseudoMersennePrime;k.bn.prime={p127:o(127,[[0,-1]]),p25519:o(255,[[0,-19]]),p192k:o(192,[[32,-1],[12,-1],[8,-1],[7,-1],[6,-1],[3,-1],[0,-1]]),p224k:o(224,[[32,-1],[12,-1],[11,-1],[9,-1],[7,-1],[4,-1],[1,-1],[0,-1]]),p256k:o(256,[[32,-1],[9,-1],[8,-1],[7,-1],[6,-1],[4,-1],[0,-1]]),p192:o(192,[[0,-1],[64,-1]]),p224:o(224,[[0,1],[96,-1]]),p256:o(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:o(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:o(521,[[0,-1]])},k.bn.random=function(a,b){"object"!=typeof a&&(a=new k.bn(a));for(var c,d,e=a.limbs.length,f=a.limbs[e-1]+1,g=new k.bn;;){do c=k.random.randomWords(e,b),0>c[e-1]&&(c[e-1]+=4294967296);while(Math.floor(c[e-1]/f)===Math.floor(4294967296/f));for(c[e-1]%=f,d=0;e-1>d;d++)c[d]&=a.radixMask;if(g.limbs=c,!g.greaterEquals(a))return g}},k.ecc={},k.ecc.point=function(a,b,c){b===h?this.isIdentity=i:(this.x=b,this.y=c,this.isIdentity=j),this.curve=a},k.ecc.point.prototype={toJac:function(){return new k.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(a){return this.toJac().mult(a,this).toAffine()},mult2:function(a,b,c){return this.toJac().mult2(a,this,b,c).toAffine()},multiples:function(){var a,b,c;if(this.S===h)for(c=this.toJac().doubl(),a=this.S=[new k.ecc.point(this.curve),this,c.toAffine()],b=3;16>b;b++)c=c.add(this),a.push(c.toAffine());return this.S},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return k.bitArray.concat(this.x.toBits(),this.y.toBits())}},k.ecc.pointJac=function(a,b,c,d){b===h?this.isIdentity=i:(this.x=b,this.y=c,this.z=d,this.isIdentity=j),this.curve=a},k.ecc.pointJac.prototype={add:function(a){var b,c,d,e;if(this.curve!==a.curve)throw"sjcl['ecc']['add'](): Points must be on the same curve to add them!";return this.isIdentity?a.toJac():a.isIdentity?this:(b=this.z.square(),c=a.x.mul(b).subM(this.x),c.equals(0)?this.y.equals(a.y.mul(b.mul(this.z)))?this.doubl():new k.ecc.pointJac(this.curve):(b=a.y.mul(b.mul(this.z)).subM(this.y),d=c.square(),a=b.square(),e=c.square().mul(c).addM(this.x.add(this.x).mul(d)),a=a.subM(e),b=this.x.mul(d).subM(a).mul(b),d=this.y.mul(c.square().mul(c)),b=b.subM(d),c=this.z.mul(c),new k.ecc.pointJac(this.curve,a,b,c)))},doubl:function(){if(this.isIdentity)return this;var a=this.y.square(),b=a.mul(this.x.mul(4)),c=a.square().mul(8),a=this.z.square(),d=this.curve.a.toString()==new k.bn(-3).toString()?this.x.sub(a).mul(3).mul(this.x.add(a)):this.x.square().mul(3).add(a.square().mul(this.curve.a)),a=d.square().subM(b).subM(b),b=b.sub(a).mul(d).subM(c),c=this.y.add(this.y).mul(this.z);return new k.ecc.pointJac(this.curve,a,b,c)},toAffine:function(){if(this.isIdentity||this.z.equals(0))return new k.ecc.point(this.curve);var a=this.z.inverse(),b=a.square();return new k.ecc.point(this.curve,this.x.mul(b).fullReduce(),this.y.mul(b.mul(a)).fullReduce())},mult:function(a,b){"number"==typeof a?a=[a]:a.limbs!==h&&(a=a.normalize().limbs);var c,d,e=new k.ecc.point(this.curve).toJac(),f=b.multiples();for(c=a.length-1;c>=0;c--)for(d=k.bn.prototype.radix-4;d>=0;d-=4)e=e.doubl().doubl().doubl().doubl().add(f[a[c]>>d&15]);return e},mult2:function(a,b,c,d){"number"==typeof a?a=[a]:a.limbs!==h&&(a=a.normalize().limbs),"number"==typeof c?c=[c]:c.limbs!==h&&(c=c.normalize().limbs);var e,f=new k.ecc.point(this.curve).toJac();b=b.multiples();var g,i,j=d.multiples();for(d=Math.max(a.length,c.length)-1;d>=0;d--)for(g=0|a[d],i=0|c[d],e=k.bn.prototype.radix-4;e>=0;e-=4)f=f.doubl().doubl().doubl().doubl().add(b[g>>e&15]).add(j[i>>e&15]);return f},isValid:function(){var a=this.z.square(),b=a.square(),a=b.mul(a);return this.y.square().equals(this.curve.b.mul(a).add(this.x.mul(this.curve.a.mul(b).add(this.x.square()))))}},k.ecc.curve=function(a,b,c,d,e,f){this.field=a,this.r=new k.bn(b),this.a=new a(c),this.b=new a(d),this.G=new k.ecc.point(this,new a(e),new a(f))},k.ecc.curve.prototype.fromBits=function(a){var b=k.bitArray,c=this.field.prototype.exponent+7&-8;if(a=new k.ecc.point(this,this.field.fromBits(b.bitSlice(a,0,c)),this.field.fromBits(b.bitSlice(a,c,2*c))),!a.isValid())throw new k.exception.corrupt("not on the curve!");return a},k.ecc.curves={c192:new k.ecc.curve(k.bn.prime.p192,"0xffffffffffffffffffffffff99def836146bc9b1b4d22831",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new k.ecc.curve(k.bn.prime.p224,"0xffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new k.ecc.curve(k.bn.prime.p256,"0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new k.ecc.curve(k.bn.prime.p384,"0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),k192:new k.ecc.curve(k.bn.prime.p192k,"0xfffffffffffffffffffffffe26f2fc170f69466a74defd8d",0,3,"0xdb4ff10ec057e9ae26b07d0280b7f4341da5d1b1eae06c7d","0x9b2f2f6d9c5628a7844163d015be86344082aa88d95e2f9d"),k224:new k.ecc.curve(k.bn.prime.p224k,"0x010000000000000000000000000001dce8d2ec6184caf0a971769fb1f7",0,5,"0xa1455b334df099df30fc28a169a467e9e47075a90f7e650eb6b7a45c","0x7e089fed7fba344282cafbd6f7e319f7c0b0bd59e2ca4bdb556d61a5"),k256:new k.ecc.curve(k.bn.prime.p256k,"0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",0,7,"0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},k.ecc.P=function(a){k.ecc[a]={publicKey:function(a,b){this.f=a,this.i=a.r.bitLength(),this.A=b instanceof Array?a.fromBits(b):b,this.get=function(){var a=this.A.toBits(),b=k.bitArray.bitLength(a),c=k.bitArray.bitSlice(a,0,b/2),a=k.bitArray.bitSlice(a,b/2);return{x:c,y:a}}},secretKey:function(a,b){this.f=a,this.i=a.r.bitLength(),this.t=b,this.get=function(){return this.t.toBits()}},generateKeys:function(b,c,d){if(b===h&&(b=256),"number"==typeof b&&(b=k.ecc.curves["c"+b],b===h))throw new k.exception.invalid("no such curve");return d===h&&(d=k.bn.random(b.r,c)),c=b.G.mult(d),{pub:new k.ecc[a].publicKey(b,c),sec:new k.ecc[a].secretKey(b,d)}}}},k.ecc.P("elGamal"),k.ecc.elGamal.publicKey.prototype={kem:function(a){a=k.bn.random(this.f.r,a);var b=this.f.G.mult(a).toBits();return{key:k.hash.sha256.hash(this.A.mult(a).toBits()),tag:b}}},k.ecc.elGamal.secretKey.prototype={unkem:function(a){return k.hash.sha256.hash(this.f.fromBits(a).mult(this.t).toBits())},dh:function(a){return k.hash.sha256.hash(a.A.mult(this.t).toBits())}},k.ecc.P("ecdsa"),k.ecc.ecdsa.secretKey.prototype={sign:function(a,b,c,d){k.bitArray.bitLength(a)>this.i&&(a=k.bitArray.clamp(a,this.i));var e=this.f.r,f=e.bitLength();return d=d||k.bn.random(e.sub(1),b).add(1),b=this.f.G.mult(d).x.mod(e),a=k.bn.fromBits(a).add(b.mul(this.t)),c=c?a.inverseMod(e).mul(d).mod(e):a.mul(d.inverseMod(e)).mod(e),k.bitArray.concat(b.toBits(f),c.toBits(f))}},k.ecc.ecdsa.publicKey.prototype={verify:function(a,b,c){k.bitArray.bitLength(a)>this.i&&(a=k.bitArray.clamp(a,this.i));var d=k.bitArray,e=this.f.r,f=this.i,g=k.bn.fromBits(d.bitSlice(b,0,f)),d=k.bn.fromBits(d.bitSlice(b,f,2*f)),j=c?d:d.inverseMod(e),f=k.bn.fromBits(a).mul(j).mod(e),j=g.mul(j).mod(e),f=this.f.G.mult2(f,j,this.A).x;if(g.equals(0)||d.equals(0)||g.greaterEquals(e)||d.greaterEquals(e)||!f.equals(g)){if(c===h)return this.verify(a,b,i);throw new k.exception.corrupt("signature didn't check out")}return i}},AeroGear.DataManager=function(a){return this instanceof AeroGear.DataManager?(this.add=function(a){a=a||{};var b,c,d,e,f;a=Array.isArray(a)?a:[a],a=a.map(function(a){if(f=a.settings||{},d=f.fallback===!1?!1:!0,d&&(e=f.preferred?f.preferred:AeroGear.DataManager.preferred,"string"!=typeof a&&(c=a.type||"Memory",!(c in AeroGear.DataManager.validAdapters))))for(b=0;b<e.length;b++)if(e[b]in AeroGear.DataManager.validAdapters)return("IndexedDB"===c||"WebSQL"===c)&&(a.settings=AeroGear.extend(a.settings||{},{async:!0})),a.type=e[b],a;return a},this),AeroGear.Core.call(this),this.add(a),this.add=this._add},this._add=this.add,this.remove=function(a){AeroGear.Core.call(this),this.remove(a),this.remove=this._remove},this._remove=this.remove,this.lib="DataManager",this.type=a?a.type||"Memory":"Memory",this.collectionName="stores",void this.add(a)):new AeroGear.DataManager(a)},AeroGear.DataManager.prototype=AeroGear.Core,AeroGear.DataManager.constructor=AeroGear.DataManager,AeroGear.DataManager.validAdapters={},AeroGear.DataManager.preferred=["IndexedDB","WebSQL","SessionLocal","Memory"],AeroGear.DataManager.validateAdapter=function(a,b){b.isValid()&&(AeroGear.DataManager.validAdapters[a]=b)},AeroGear.DataManager.adapters={},AeroGear.DataManager.STATUS_NEW=1,AeroGear.DataManager.STATUS_MODIFIED=2,AeroGear.DataManager.STATUS_REMOVED=0,AeroGear.DataManager.adapters.base=function(b,c){if(this instanceof AeroGear.DataManager.adapters.base)throw"Invalid instantiation of base class AeroGear.DataManager.adapters.base";c=c||{};var d=null,e=c.recordId?c.recordId:"id",f=c.crypto||{},g=f.options||{};this.getData=function(){return d||[]},this.setData=function(a){d=a},this.getRecordId=function(){return e},this.encrypt=function(c){var d;return f.agcrypto?(g.data=k.codec.utf8String.toBits(JSON.stringify(c)),d={id:c[e],data:f.agcrypto.encrypt(g)},a.localStorage.setItem("ag-"+b+"-IV",JSON.stringify({id:f.agcrypto.getIV()})),d):c},this.decrypt=function(c,d){var e,h;return f.agcrypto?(h=JSON.parse(a.localStorage.getItem("ag-"+b+"-IV"))||{},g.IV=h.id,c=Array.isArray(c)?c:[c],e=c.map(function(a){return g.data=a.data,JSON.parse(k.codec.utf8String.fromBits(f.agcrypto.decrypt(g)))
}),d?e[0]:e):c}},AeroGear.DataManager.adapters.Memory=function(a,b){return this instanceof AeroGear.DataManager.adapters.Memory?(AeroGear.DataManager.adapters.base.apply(this,arguments),this.emptyData=function(){this.setData(null)},this.addDataRecord=function(a){this.getData().push(a)},this.updateDataRecord=function(a,b){this.getData()[a]=b},this.removeDataRecord=function(a){this.getData().splice(a,1)},this.open=function(){return Promise.resolve()},this.close=function(){},void(this.traverseObjects=function(a,b,c){for(;"object"==typeof b&&c;)a=Object.keys(b)[0],b=b[a],c=c[a];return b===c?!0:!1})):new AeroGear.DataManager.adapters.Memory(a,b)},AeroGear.DataManager.adapters.Memory.isValid=function(){return!0},AeroGear.DataManager.adapters.Memory.prototype.read=function(a){var b={};return b[this.getRecordId()]=a,a?this.filter(b).then(function(a){return a}):Promise.resolve(this.getData())},AeroGear.DataManager.adapters.Memory.prototype.save=function(a,b){var c=!1;if(a=Array.isArray(a)?a:[a],b&&b.reset)this.setData(a);else if(this.getData()&&0!==this.getData().length)for(var d=0;d<a.length;d++){for(var e in this.getData())if(this.getData()[e][this.getRecordId()]===a[d][this.getRecordId()]){this.updateDataRecord(e,a[d]),c=!0;break}c||this.addDataRecord(a[d]),c=!1}else this.setData(a);return Promise.resolve(this.getData())},AeroGear.DataManager.adapters.Memory.prototype.remove=function(a){var b,c,d;if(!a)return this.emptyData(),Promise.resolve(this.getData());a=Array.isArray(a)?a:[a];for(var e=0;e<a.length;e++){if("string"==typeof a[e]||"number"==typeof a[e])b=a[e];else{if(!a)continue;b=a[e][this.getRecordId()]}c=this.getData(!0);for(d in c)c[d][this.getRecordId()]===b&&this.removeDataRecord(d)}return Promise.resolve(this.getData())},AeroGear.DataManager.adapters.Memory.prototype.filter=function(a,b){var c,d,e,f,g=this;return a?(c=this.getData().filter(function(c){var h,i,j=b?!1:!0,k=Object.keys(a);for(d=0;d<k.length;d++){if(a[k[d]].data)for(h=a[k[d]],i=h.matchAny?!1:!0,e=0;e<h.data.length;e++)if(Array.isArray(c[k[d]]))if(c[k[d]].length){if(b||h.matchAny){for(f=0;f<c[k[d]].length;f++)if(h.data[e]===c[k[d]][f]){i=!0;break}}else if(c[k[d]].length!==h.data.length)i=!1;else for(f=0;f<c[k[d]].length;f++)if(h.data[f]!==c[k[d]][f]){i=!1;break}}else i=!1;else if("object"==typeof h.data[e]){if(h.matchAny&&g.traverseObjects(k[d],h.data[e],c[k[d]])){i=!0;break}if(!h.matchAny&&!g.traverseObjects(k[d],h.data[e],c[k[d]])){i=!1;break}}else{if(h.matchAny&&h.data[e]===c[k[d]]){i=!0;break}if(!h.matchAny&&h.data[e]!==c[k[d]]){i=!1;break}}else if(Array.isArray(c[k[d]]))if(i=b?!1:!0,c[k[d]].length)for(e=0;e<c[k[d]].length;e++){if(b&&a[k[d]]===c[k[d]][e]){i=!0;break}if(!b&&a[k[d]]!==c[k[d]][e]){i=!1;break}}else i=!1;else i="object"==typeof a[k[d]]?g.traverseObjects(k[d],a[k[d]],c[k[d]]):a[k[d]]===c[k[d]]?!0:!1;if(b&&i){j=!0;break}if(!b&&!i){j=!1;break}}return j}),Promise.resolve(c)):(c=this.getData()||[],Promise.resolve(c))},AeroGear.DataManager.validateAdapter("Memory",AeroGear.DataManager.adapters.Memory),AeroGear.DataManager.adapters.SessionLocal=function(b,c){if(!(this instanceof AeroGear.DataManager.adapters.SessionLocal))return new AeroGear.DataManager.adapters.SessionLocal(b,c);AeroGear.DataManager.adapters.Memory.apply(this,arguments);var d=c.storageType||"sessionStorage",e=b,f=document.location.pathname.replace(/[\/\.]/g,"-"),g=e+f,h=a[d].getItem(g),i=h?this.decrypt(JSON.parse(h),!0):null;i&&AeroGear.DataManager.adapters.Memory.prototype.save.call(this,i,!0),this.getStoreType=function(){return d},this.getStoreKey=function(){return g}},AeroGear.DataManager.adapters.SessionLocal.isValid=function(){try{return!(!a.localStorage||!a.sessionStorage)}catch(b){return!1}},AeroGear.DataManager.adapters.SessionLocal.prototype=Object.create(new AeroGear.DataManager.adapters.Memory,{save:{value:function(b,c){var d=this,e=c&&c.reset?c.reset:!1,f=a[this.getStoreType()].getItem(this.getStoreKey());return AeroGear.DataManager.adapters.Memory.prototype.save.apply(this,[arguments[0],{reset:e}]).then(function(b){try{a[d.getStoreType()].setItem(d.getStoreKey(),JSON.stringify(d.encrypt(b)))}catch(c){return f=f?JSON.parse(f):[],AeroGear.DataManager.adapters.Memory.prototype.save.apply(d,[f,{reset:e}]).then(function(){return Promise.reject()})}return b})},enumerable:!0,configurable:!0,writable:!0},remove:{value:function(){var b=this;return AeroGear.DataManager.adapters.Memory.prototype.remove.apply(this,arguments).then(function(c){a[b.getStoreType()].setItem(b.getStoreKey(),JSON.stringify(b.encrypt(c)))})},enumerable:!0,configurable:!0,writable:!0}}),AeroGear.DataManager.validateAdapter("SessionLocal",AeroGear.DataManager.adapters.SessionLocal),AeroGear.DataManager.adapters.IndexedDB=function(c,d){if(!a.indexedDB)throw"Your browser doesn't support IndexedDB";if(!(this instanceof AeroGear.DataManager.adapters.IndexedDB))return new AeroGear.DataManager.adapters.IndexedDB(c,d);AeroGear.DataManager.adapters.base.apply(this,arguments),d=d||{};var e,f=d.auto===b||d.auto?!0:!1;this.getDatabase=function(){return e},this.setDatabase=function(a){e=a},this.getStoreName=function(){return c},this.getAsync=function(){return!0},this.run=function(a){var b=this;if(e)a.call(this,e);else{if(!f)throw"Database not opened";this.open().then(function(c,d){if("error"===d)throw"Database not opened";a.call(b,e)})}}},AeroGear.DataManager.adapters.IndexedDB.isValid=function(){return!!a.indexedDB},AeroGear.DataManager.adapters.IndexedDB.prototype.open=function(){var b,c,d=this,e=this.getStoreName(),f=this.getRecordId();return new Promise(function(g,h){b=a.indexedDB.open(e),b.onsuccess=function(a){c=a.target.result,d.setDatabase(c),g(c)},b.onerror=function(a){h(a)},b.onupgradeneeded=function(a){c=a.target.result,c.createObjectStore(e,{keyPath:f})}})},AeroGear.DataManager.adapters.IndexedDB.prototype.read=function(a){var b,c,d,e,f=this,g=[],h=this.getStoreName();return new Promise(function(i,j){f.run.call(f,function(k){return k.objectStoreNames.contains(h)?(b=k.transaction(h),c=b.objectStore(h),a?(e=c.get(a),e.onsuccess=function(){g.push(e.result)}):(d=c.openCursor(),d.onsuccess=function(a){var b=a.target.result;b&&(g.push(b.value),b.continue())}),b.oncomplete=function(){i(f.decrypt(g))},void(b.onerror=function(a){j(a)})):i([])})})},AeroGear.DataManager.adapters.IndexedDB.prototype.save=function(a,b){b=b||{};var c,d,e=this,f=this.getStoreName(),g=0;return new Promise(function(h,i){e.run.call(e,function(j){if(c=j.transaction(f,"readwrite"),d=c.objectStore(f),b.reset&&d.clear(),Array.isArray(a))for(g;g<a.length;g++)d.put(this.encrypt(a[g]));else d.put(this.encrypt(a));c.oncomplete=function(){e.read().then(function(a){h(a)}).catch(function(){i(a,status)})},c.onerror=function(a){i(a)}})})},AeroGear.DataManager.adapters.IndexedDB.prototype.remove=function(a){var b,c,d=this,e=this.getDatabase(),f=this.getStoreName(),g=0;return new Promise(function(h,i){d.run.call(d,function(){if(c=e.transaction(f,"readwrite"),b=c.objectStore(f),a)for(a=Array.isArray(a)?a:[a],g;g<a.length;g++)if("string"==typeof a[g]||"number"==typeof a[g])b.delete(a[g]);else{if(!a)continue;b.delete(a[g][this.getRecordId()])}else b.clear();c.oncomplete=function(){d.read().then(function(a){h(a)}).catch(function(a){i(a)})},c.onerror=function(a){i(a)}})})},AeroGear.DataManager.adapters.IndexedDB.prototype.filter=function(a,b){var c=this;return new Promise(function(d,e){c.run.call(c,function(){this.read().then(function(e){AeroGear.DataManager.adapters.Memory.prototype.save.call(c,e,!0),AeroGear.DataManager.adapters.Memory.prototype.filter.call(c,a,b).then(function(a){d(a)})}).catch(function(a){e(a)})})})},AeroGear.DataManager.adapters.IndexedDB.prototype.close=function(){var a=this.getDatabase();a&&a.close()},AeroGear.DataManager.validateAdapter("IndexedDB",AeroGear.DataManager.adapters.IndexedDB),AeroGear.DataManager.adapters.WebSQL=function(c,d){if(!a.openDatabase)throw"Your browser doesn't support WebSQL";if(!(this instanceof AeroGear.DataManager.adapters.WebSQL))return new AeroGear.DataManager.adapters.WebSQL(c,d);AeroGear.DataManager.adapters.base.apply(this,arguments),d=d||{};var e,f=d.auto===b||d.auto?!0:!1;this.getDatabase=function(){return e},this.setDatabase=function(a){e=a},this.getStoreName=function(){return c},this.getAsync=function(){return!0},this.run=function(a){var b=this;if(e)a.call(this,e);else{if(!f)throw"Database not opened";this.open().then(function(){a.call(b,e)}).catch(function(){throw"Database not opened"})}}},AeroGear.DataManager.adapters.WebSQL.isValid=function(){return!!a.openDatabase},AeroGear.DataManager.adapters.WebSQL.prototype.open=function(){var b,c,d,e=this,f="1",g=2097152,h=this.getRecordId(),i=this.getStoreName();return b=a.openDatabase(i,f,"AeroGear WebSQL Store",g),new Promise(function(a,f){d=function(a,b){f(b)},c=function(){e.setDatabase(b),a(b)},b.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS '"+i+"' ( "+h+" REAL UNIQUE, json)",[],c,d)})})},AeroGear.DataManager.adapters.WebSQL.prototype.close=function(){},AeroGear.DataManager.adapters.WebSQL.prototype.read=function(a){var b,c,d,e=this,f=[],g=[],h=this.getStoreName(),i=this.getDatabase(),j=0;return new Promise(function(k,l){e.run.call(e,function(){d=function(a,b){l(b)},c=function(a,b){var c=b.rows.length;for(j;c>j;j++)f.push(JSON.parse(b.rows.item(j).json));k(e.decrypt(f))},b="SELECT * FROM '"+h+"'",a&&(b+=" WHERE ID = ?",g=[a]),i.transaction(function(a){a.executeSql(b,g,c,d)})})})},AeroGear.DataManager.adapters.WebSQL.prototype.save=function(a,b){b=b||{};var c,d,e=this,f=this.getRecordId(),g=this.getStoreName();return new Promise(function(h,i){e.run.call(e,function(j){c=function(a,b){i(b)},d=function(){e.read().then(function(a){h(a)}).catch(function(a){i(a)})},a=Array.isArray(a)?a:[a],j.transaction(function(c){b.reset&&(c.executeSql("DROP TABLE "+g),c.executeSql("CREATE TABLE IF NOT EXISTS '"+g+"' ( "+f+" REAL UNIQUE, json)")),a.forEach(function(a){a=e.encrypt(a),c.executeSql("INSERT OR REPLACE INTO '"+g+"' ( id, json ) VALUES ( ?, ? ) ",[a[f],JSON.stringify(a)])})},c,d)})})},AeroGear.DataManager.adapters.WebSQL.prototype.remove=function(a){var b,c,d,e=this,f=this.getStoreName(),g=0;return new Promise(function(h,i){e.run.call(e,function(j){d=function(a,b){i(b)},c=function(){e.read().then(function(a){h(a)}).catch(function(a){i(a)})},b="DELETE FROM '"+f+"'",a?(a=Array.isArray(a)?a:[a],j.transaction(function(c){for(g;g<a.length;g++)if("string"==typeof a[g]||"number"==typeof a[g])c.executeSql(b+" WHERE ID = ? ",[a[g]]);else{if(!a)continue;c.executeSql(b+" WHERE ID = ? ",[a[g][this.getRecordId()]])}},d,c)):j.transaction(function(a){a.executeSql(b,[],c,d)})})})},AeroGear.DataManager.adapters.WebSQL.prototype.filter=function(a,b){var c=this;return new Promise(function(d,e){c.run.call(c,function(){this.read().then(function(e){AeroGear.DataManager.adapters.Memory.prototype.save.call(c,e,!0),AeroGear.DataManager.adapters.Memory.prototype.filter.call(c,a,b).then(function(a){d(a)})}).catch(function(a){e(a)})})})},AeroGear.DataManager.validateAdapter("WebSQL",AeroGear.DataManager.adapters.WebSQL),AeroGear.Notifier=function(a){return this instanceof AeroGear.Notifier?(AeroGear.Core.call(this),this.lib="Notifier",this.type=a?a.type||"vertx":"vertx",this.collectionName="clients",void this.add(a)):new AeroGear.Notifier(a)},AeroGear.Notifier.prototype=AeroGear.Core,AeroGear.Notifier.constructor=AeroGear.Notifier,AeroGear.Notifier.adapters={},AeroGear.Notifier.CONNECTING=0,AeroGear.Notifier.CONNECTED=1,AeroGear.Notifier.DISCONNECTING=2,AeroGear.Notifier.DISCONNECTED=3,AeroGear.Notifier.adapters.base=function(a,b){if(this instanceof AeroGear.Notifier.adapters.base)throw"Invalid instantiation of base class AeroGear.Notifier.adapters.base";b=b||{};var c=b.connectURL||"",d=b.channels||[],e=!!b.autoConnect||d.length,f=AeroGear.Notifier.CONNECTING,g=null;this.getConnectURL=function(){return c},this.setConnectURL=function(a){c=a},this.getChannels=function(){return d},this.addChannel=function(a){d.push(a)},this.getChannelIndex=function(a){for(var b=0;b<d.length;b++)if(d[b].address===a)return b;return-1},this.removeChannel=function(a){var b=this.getChannelIndex(a.address);b>=0&&d.splice(b,1)},this.getState=function(){return f},this.setState=function(a){f=a},this.getClient=function(){return g},this.setClient=function(a){g=a},!e&&!d.length||b.login||b.password||this.connect({url:c,onConnect:b.onConnect,onDisconnect:b.onDisconnect,onConnectError:b.onConnectError,onMessage:b.onMessage})},AeroGear.Notifier.adapters.SimplePush=function(a,b){if(!(this instanceof AeroGear.Notifier.adapters.SimplePush))return new AeroGear.Notifier.adapters.SimplePush(a,b);b=b||{};var c=a,d=b.connectURL||"",e=b.useNative||!1,f=null,g=JSON.parse(localStorage.getItem("ag-push-store")||"{}");g.channels=g.channels||[];for(var h in g.channels)g.channels[h].state="available";localStorage.setItem("ag-push-store",JSON.stringify(g)),this.getSettings=function(){return b},this.getName=function(){return c},this.getConnectURL=function(){return d},this.setConnectURL=function(a){d=a},this.getUseNative=function(){return e},this.getClient=function(){return f},this.setClient=function(a){f=a},this.getPushStore=function(){return g},this.setPushStore=function(a){g=a,localStorage.setItem("ag-push-store",JSON.stringify(a))},this.processMessage=function(a){var b,c,d;if("register"===a.messageType&&200===a.status)b={channelID:a.channelID,version:a.version,state:"used",pushEndpoint:a.pushEndpoint},g.channels=this.updateChannel(g.channels,b),this.setPushStore(g),b.pushEndpoint=a.pushEndpoint,jQuery(navigator.push).trigger(jQuery.Event(a.channelID+"-success",{target:{result:b.pushEndpoint}}));else{if("register"===a.messageType)throw"SimplePushRegistrationError";if("unregister"===a.messageType&&200===a.status)g.channels.splice(this.findChannelIndex(g.channels,"channelID",a.channelID),1),this.setPushStore(g);else{if("unregister"===a.messageType)throw"SimplePushUnregistrationError";if("notification"===a.messageType){c=a.updates,d=JSON.parse(localStorage.getItem("ag-push-store"));for(var e=0,h=c.length;h>e;e++){var i=d.channels.filter(function(a){return a.channelID===c[e].channelID});c[e].pushEndpoint=i?i[0].pushEndpoint:"",jQuery(navigator.push).trigger(jQuery.Event("push",{message:c[e]}))}a.messageType="ack",f.send(JSON.stringify(a))}}}},this.generateHello=function(){var a=g.channels,b={messageType:"hello",uaid:"",channelIDs:[]};if(g.uaid&&(b.uaid=g.uaid),a&&""!==b.uaid)for(var c=a.length,d=c-1;d>-1;d--)b.channelIDs.push(g.channels[d].channelID);return JSON.stringify(b)},this.findChannelIndex=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]===c)return d},this.updateChannel=function(a,b){for(var c=0;c<a.length;c++)if(a[c].channelID===b.channelID){a[c].version=b.version,a[c].state=b.state,a[c].pushEndpoint=b.pushEndpoint;break}return a},this.bindSubscribeSuccess=function(a,b){jQuery(navigator.push).off(a+"-success"),jQuery(navigator.push).on(a+"-success",function(a){b.onsuccess(a)})}},AeroGear.Notifier.adapters.SimplePush.prototype.connect=function(a){a=a||{};var c=this,d=this.getUseNative()?new WebSocket(a.url||this.getConnectURL()):new SockJS(a.url||this.getConnectURL(),b,a);d.onopen=function(){d.send(c.generateHello())},d.onerror=function(){a.onConnectError&&a.onConnectError.apply(this,arguments)},d.onmessage=function(b){var d=c.getPushStore();b=JSON.parse(b.data),"hello"===b.messageType?(b.uaid!==d.uaid&&(d.uaid=b.uaid,c.setPushStore(d)),a.onConnect&&a.onConnect(b)):c.processMessage(b)},d.onclose=function(){a.onClose&&a.onClose.apply(this,arguments)},this.setClient(d)},AeroGear.Notifier.adapters.SimplePush.prototype.disconnect=function(a){var b=this.getClient();b.close(),a&&a()},AeroGear.Notifier.adapters.SimplePush.prototype.subscribe=function(a,c){var d,e,f=!1,g=this.getClient(),h=this.getPushStore();c&&this.unsubscribe(this.getChannels()),a=Array.isArray(a)?a:[a],h.channels=h.channels||[],e=h.channels.length;for(var i=0;i<a.length;i++)e&&(d=this.findChannelIndex(h.channels,"state","available"),d!==b&&(this.bindSubscribeSuccess(h.channels[d].channelID,a[i].requestObject),a[i].channelID=h.channels[d].channelID,a[i].state="used",a[i].pushEndpoint=h.channels[d].pushEndpoint,setTimeout(function(a){return function(){jQuery(navigator.push).trigger(jQuery.Event(a.channelID+"-success",{target:{result:a.pushEndpoint}}))}}(a[i]),0),h.channels[d]=a[i],f=!0)),f||(a[i].channelID=a[i].channelID||uuid(),a[i].state="used",this.bindSubscribeSuccess(a[i].channelID,a[i].requestObject),g.send('{"messageType": "register", "channelID": "'+a[i].channelID+'"}'),h.channels.push(a[i])),f=!1;this.setPushStore(h)},AeroGear.Notifier.adapters.SimplePush.prototype.unsubscribe=function(a){var b,c=this.getClient(),d=JSON.parse(localStorage.getItem("ag-push-store"));a=Array.isArray(a)?a:[a];for(var e=0;e<a.length;e++)b=d.channels.filter(function(b){return b.pushEndpoint===a[e]}),c.send('{"messageType": "unregister", "channelID": "'+b[0].channelID+'"}')},AeroGear.Notifier.adapters.vertx=function(a,b){if(!(this instanceof AeroGear.Notifier.adapters.vertx))return new AeroGear.Notifier.adapters.vertx(a,b);b=b||{},AeroGear.Notifier.adapters.base.apply(this,arguments)},AeroGear.Notifier.adapters.vertx.prototype.connect=function(a){a=a||{};var b=this,c=new vertx.EventBus(a.url||this.getConnectURL(),a);c.onopen=function(){var c=b.getChannels().slice(0);b.setState(AeroGear.Notifier.CONNECTED),b.subscribe(c,!0),a.onConnect&&a.onConnect.apply(this,arguments)},c.onclose=function(){b.getState()===AeroGear.Notifier.DISCONNECTING?(b.setState(AeroGear.Notifier.DISCONNECTED),a.onDisconnect&&a.onDisconnect.apply(this,arguments)):a.onConnectError&&a.onConnectError.apply(this,arguments)},this.setClient(c)},AeroGear.Notifier.adapters.vertx.prototype.disconnect=function(){var a=this.getClient();this.getState()===AeroGear.Notifier.CONNECTED&&(this.setState(AeroGear.Notifier.DISCONNECTING),a.close())},AeroGear.Notifier.adapters.vertx.prototype.subscribe=function(a,b){var c=this.getClient();b&&this.unsubscribe(this.getChannels()),a=Array.isArray(a)?a:[a];for(var d=0;d<a.length;d++)this.addChannel(a[d]),c.registerHandler(a[d].address,a[d].callback)},AeroGear.Notifier.adapters.vertx.prototype.unsubscribe=function(a){var b=this.getClient(),c=this.getChannels();a=Array.isArray(a)?a:[a];for(var d=0;d<a.length;d++)b.unregisterHandler(a[d].address,a[d].callback||c[this.getChannelIndex(a[d].address)].callback),this.removeChannel(a[d])},AeroGear.Notifier.adapters.vertx.prototype.send=function(a,b,c){var d=this.getClient();typeof b!==Boolean||c||(c=b,b=""),b=b||"",d[c?"publish":"send"](a,b)},AeroGear.Notifier.adapters.stompws=function(a,b){if(!(this instanceof AeroGear.Notifier.adapters.stompws))return new AeroGear.Notifier.adapters.stompws(a,b);b=b||{},AeroGear.Notifier.adapters.base.apply(this,arguments)},AeroGear.Notifier.adapters.stompws.prototype.connect=function(a){a=a||{};var b=this,c=new Stomp.client(a.url||this.getConnectURL(),a.protocol||"v11.stomp"),d=function(){var c=b.getChannels().slice(0);b.setState(AeroGear.Notifier.CONNECTED),b.subscribe(c,!0),a.onConnect&&a.onConnect.apply(this,arguments)},e=function(){b.setState(AeroGear.Notifier.DISCONNECTED),a.onConnectError&&a.onConnectError.apply(this,arguments)};c.connect(a.login,a.password,d,e,a.host),this.setClient(c)},AeroGear.Notifier.adapters.stompws.prototype.disconnect=function(a){var b=this,c=this.getClient(),d=function(){b.getState()===AeroGear.Notifier.DISCONNECTING&&(b.setState(AeroGear.Notifier.DISCONNECTED),a&&a.apply(this,arguments))};this.getState()===AeroGear.Notifier.CONNECTED&&(this.setState(AeroGear.Notifier.DISCONNECTING),c.disconnect(d))},AeroGear.Notifier.adapters.stompws.prototype.subscribe=function(a,b){var c=this.getClient();b&&this.unsubscribe(this.getChannels()),a=Array.isArray(a)?a:[a];for(var d=0;d<a.length;d++)a[d].id=c.subscribe(a[d].address,a[d].callback),this.addChannel(a[d])},AeroGear.Notifier.adapters.stompws.prototype.debug=function(a){var b=this.getClient(),c=function(){a&&a.apply(this,arguments)};b&&(b.debug=c)},AeroGear.Notifier.adapters.stompws.prototype.unsubscribe=function(a){var b=this.getClient(),c=this.getChannels();a=Array.isArray(a)?a:[a];for(var d=0;d<a.length;d++)b.unsubscribe(a[d].id||c[this.getChannelIndex(a[d].address)].id),this.removeChannel(a[d])},AeroGear.Notifier.adapters.stompws.prototype.send=function(a,b){var c={},d=this.getClient();b=b||"",b.headers&&(c=b.headers,b=b.body),d.send(a,c,b)},AeroGear.Notifier.adapters.mqttws=function(a,b){if(!(this instanceof AeroGear.Notifier.adapters.mqttws))return new AeroGear.Notifier.adapters.mqttws(a,b);b=b||{},AeroGear.Notifier.adapters.base.apply(this,arguments);var c=b.clientId||"agClientId";this.getClientId=function(){return c},this.setClientId=function(a){c=a},this.processConnectOptions=function(a){return a.onConnect&&(a.onSuccess=a.onConnect,delete a.onConnect),a.onConnectError&&(a.onFailure=a.onConnectError,delete a.onConnectError),a.login&&(a.userName=a.login,delete a.login),a.url&&delete a.url,a.clientId&&delete a.clientId,a.onMessage&&delete a.onMessage,a},this.processURL=function(a){var b={},c=a.split("/"),d=c[0].split(":")[0],e=c[2].split(":"),f="/"+(c[3]||"mqtt");return b.hostname=e[0],b.port=Number(e[1])||("wss"===d?443:80),b.path=f,b}},AeroGear.Notifier.adapters.mqttws.prototype.connect=function(a){a=a||{};var b,c,d=this,e=a.onConnect,f=a.onConnectError;c=this.processURL(a.url||this.getConnectURL()),b=new Paho.MQTT.Client(c.hostname,c.port,c.path,a.clientId||this.getClientId()),a.onMessage&&(b.onMessageArrived=a.onMessage),a.onConnect=function(){var a=d.getChannels().slice(0);d.setState(AeroGear.Notifier.CONNECTED),d.subscribe(a,!0),e&&e.apply(this,arguments)},a.onConnectError=function(){d.setState(AeroGear.Notifier.DISCONNECTED),f&&f.apply(this,arguments)},b.connect(this.processConnectOptions(a)),this.setClient(b)},AeroGear.Notifier.adapters.mqttws.prototype.disconnect=function(){var a=this.getClient();this.getState()===AeroGear.Notifier.CONNECTED&&(this.setState(AeroGear.Notifier.DISCONNECTING),a.disconnect())},AeroGear.Notifier.adapters.mqttws.prototype.subscribe=function(a,b){var c=this.getClient();b&&this.unsubscribe(this.getChannels()),a=Array.isArray(a)?a:[a];for(var d=0;d<a.length;d++)this.addChannel(a[d]),c.subscribe(a[d].address,a[d].subscribeOptions||{})},AeroGear.Notifier.adapters.mqttws.prototype.unsubscribe=function(a){var b=this.getClient();a=Array.isArray(a)?a:[a];for(var c=0;c<a.length;c++)b.unsubscribe(a[c].address,a[c].unsubscribeOptions||{}),this.removeChannel(a[c])},AeroGear.Notifier.adapters.mqttws.prototype.send=function(a,b,c){var d=this.getClient();b=new Paho.MQTT.Message(b||""),b.destinationName=a,c&&(c.qos&&(b.qos=c.qos),c.retained&&(b.retained=c.retained),c.duplicate&&(b.duplicate=c.duplicate)),d.send(b)},function(b){b.UnifiedPushClient=function(c,d,e){if(!c||!d||!e)throw"UnifiedPushClientException";return this instanceof b.UnifiedPushClient?(e="/"===e.substr(-1)?e:e+"/",this._ajax=function(a){return new Promise(function(b,c){var d,e=this,f=new XMLHttpRequest;if(f.open(a.type||"GET",a.url,!0,a.username,a.password),f.responseType="json",f.setRequestHeader("Content-Type","application/json"),f.setRequestHeader("Accept","application/json"),a.headers)for(d in a.headers)f.setRequestHeader(d,a.headers[d]);f.onload=function(){var a=f.status<400?"success":"error",d=e._createPromiseValue(f,a);return"success"===a?b(d):c(d)},f.onerror=function(){return c(e._createPromiseValue(f,"error"))},this._createPromiseValue=function(a,b){return{data:a.response,statusText:a.statusText||b,agXHR:a}},f.send(a.data)})},this.registerWithPushServer=function(b){b=b||{};var f=b.metadata||{};if(!f.deviceToken)throw"UnifiedPushRegistrationException";return f.categories=Array.isArray(f.categories)?f.categories:f.categories?[f.categories]:[],this._ajax({type:"POST",url:e+"rest/registry/device",headers:{Authorization:"Basic "+a.btoa(c+":"+d)},data:JSON.stringify(f)})},void(this.unregisterWithPushServer=function(b){return this._ajax({type:"DELETE",url:e+"rest/registry/device/"+b,headers:{Authorization:"Basic "+a.btoa(c+":"+d)}})})):new b.UnifiedPushClient(c,d,e)}}(AeroGear),function(b,c){b.SimplePushClient=function(d){if(!(this instanceof b.SimplePushClient))return new b.SimplePushClient(d);if(this.options=d||{},navigator.push&&this.options.useNative)return void(d.onConnect&&d.onConnect());if(this.options.useNative)if("WebSocket"in a)this.options.simplePushServerURL="wss://push.services.mozilla.com";else{if(!this.options.simplePushServerURL)throw"SimplePushConfigurationError";this.options.useNative=!1}var e=this,f={onConnect:function(){navigator.push=function(){return{register:function(){var a={onsuccess:function(){}};if(!e.simpleNotifier)throw"SimplePushConnectionError";return e.simpleNotifier.subscribe({requestObject:a}),a},unregister:function(a){e.simpleNotifier.unsubscribe(a)},reconnect:function(){e.simpleNotifier.connect(f)}}}(),navigator.setMessageHandler=navigator.mozSetMessageHandler=function(a,b){c(navigator.push).on(a,function(a){var c=a.message;b.call(this,c)})},e.options.onConnect&&e.options.onConnect()},onClose:function(){e.simpleNotifier.disconnect(e.options.onClose)}};e.simpleNotifier=b.Notifier({name:"agPushNetwork",type:"SimplePush",settings:{connectURL:e.options.simplePushServerURL,useNative:e.options.useNative}}).clients.agPushNetwork,e.simpleNotifier.connect(f)}}(AeroGear,jQuery),AeroGear.Crypto=function(){if(!a.crypto||!a.crypto.getRandomValues)throw"Your browser does not support the Web Crypto API";if(!(this instanceof AeroGear.Crypto))return new AeroGear.Crypto;var b,c,d,e;this.getSalt=function(){return e},this.getIV=function(){return d},this.getPrivateKey=function(){return b},this.getPublicKey=function(){return c},this.getRandomValue=function(){var a=new Uint32Array(1);return crypto.getRandomValues(a),a[0]},this.deriveKey=function(a,b){e=b||(e?e:this.getRandomValue());var c=k.codec.utf8String,d=2048;return k.misc.pbkdf2(a,c.toBits(e),d)},this.encrypt=function(a){a=a||{};var b=k.mode.gcm,c=new k.cipher.aes(a.key);return d=a.IV||(d?d:this.getRandomValue()),b.encrypt(c,a.data,d,a.aad,128)},this.decrypt=function(a){a=a||{};var b=k.mode.gcm,c=new k.cipher.aes(a.key);return b.decrypt(c,a.data,a.IV||d,a.aad,128)},this.hash=function(a){return k.hash.sha256.hash(a)},this.sign=function(a){a=a||{};var b=a.keys||k.ecc.ecdsa.generateKeys(192),c=k.hash.sha256.hash(a.message);return b.sec.sign(c)},this.verify=function(a){a=a||{};var b=k.hash.sha256.hash(a.message);return a.keys.pub.verify(b,a.signature)},this.KeyPair=function(a,d){var e,f;return a&&d?(b=a,c=d):(e=k.ecc.elGamal.generateKeys(192,0),f=e.pub.kem(),c=f.key,b=e.sec.unkem(f.tag)),this}},AeroGear.DiffSyncEngine=function(a){return this instanceof AeroGear.DiffSyncEngine?(this.lib="DiffSyncEngine",this.type=a?a.type||"jsonPatch":"jsonPatch",new AeroGear.DiffSyncEngine.adapters[this.type]):new AeroGear.DiffSyncEngine(a)},AeroGear.DiffSyncEngine.adapters={},AeroGear.DiffSyncEngine.adapters.diffMatchPatch=function(){if(!(this instanceof AeroGear.DiffSyncEngine.adapters.diffMatchPatch))return new AeroGear.DiffSyncEngine.adapters.diffMatchPatch;var a={docs:[],shadows:[],backups:[],edits:[]},b=new diff_match_patch;this.addDocument=function(a){this._saveDocument(JSON.parse(JSON.stringify(a))),this._saveShadow(JSON.parse(JSON.stringify(a))),this._saveShadowBackup(JSON.parse(JSON.stringify(a)),0)},this.diff=function(a){var c,d,e,f,g=this._readData(a.id,"shadows")[0];return"string"==typeof a.content?(d=a.content,e=g.content):(d=JSON.stringify(a.content),e=JSON.stringify(g.content)),c={msgType:"patch",id:a.id,clientId:g.clientId,edits:[{clientVersion:g.clientVersion,serverVersion:g.serverVersion,checksum:"",diffs:this._asAeroGearDiffs(b.diff_main(e,d))}]},g.clientVersion++,g.content=a.content,this._saveShadow(JSON.parse(JSON.stringify(g))),f=this._getEdits(a.id),f&&f.length>0&&(c.edits=f.concat(c.edits)),c},this.patch=function(a){var b=this.patchShadow(a);this.patchDocument(b),this._saveShadowBackup(b,b.clientVersion)},this._asAeroGearDiffs=function(a){return a.map(function(a){return{operation:this._asAgOperation(a[0]),text:a[1]}}.bind(this))},this._asDiffMatchPathDiffs=function(a){return a.map(function(a){return[this._asDmpOperation(a.operation),a.text]}.bind(this))},this._asDmpOperation=function(a){return"DELETE"===a?-1:"ADD"===a?1:0},this._asAgOperation=function(a){return-1===a?"DELETE":1===a?"ADD":"UNCHANGED"},this.patchShadow=function(a){var b,c,d=this.getShadow(a.id),e=a.edits;for(b=0;b<e.length;b++)c=e[b],c.clientVersion<d.clientVersion&&!this._isSeeded(c)?d=this._restoreBackup(d,c):c.serverVersion<d.serverVersion?this._removeEdit(a.id,c):(c.serverVersion===d.serverVersion&&c.clientVersion===d.clientVersion||this._isSeeded(c))&&(this.applyEditsToShadow(c,d),this._isSeeded(c)?d.clientVersion=0:c.clientVersion>=0&&d.serverVersion++,this._saveShadow(d),this._removeEdit(a.id,c));return d},this._isSeeded=function(a){return-1===a.clientVersion},this.applyEditsToShadow=function(a,c){var d,e,f,g;d="string"==typeof c.content?c.content:JSON.stringify(c.content),e=this._asDiffMatchPathDiffs(a.diffs),f=b.patch_make(d,e),g=b.patch_apply(f,d);try{c.content=JSON.parse(g[0])}catch(h){c.content=g[0]}return c},this.patchDocument=function(a){var c,d,e,f;return c=this.getDocument(a.id),d=b.diff_main(JSON.stringify(c.content),JSON.stringify(a.content)),e=b.patch_make(JSON.stringify(c.content),d),f=b.patch_apply(e,JSON.stringify(c.content)),c.content=JSON.parse(f[0]),this._saveDocument(c),f},this._saveData=function(b,c){b=Array.isArray(b)?b:[b],a[c]=b},this._readData=function(b,c){return a[c].filter(function(a){return a.id===b})},this._saveDocument=function(a){return this._saveData(a,"docs"),a},this._saveShadow=function(a){var b={id:a.id,serverVersion:a.serverVersion||0,clientId:a.clientId,clientVersion:a.clientVersion||0,content:a.content};return this._saveData(b,"shadows"),b},this._saveShadowBackup=function(a,b){var c={id:a.id,clientVersion:b,content:a.content};return this._saveData(c,"backups"),c},this.getDocument=function(a){return this._readData(a,"docs")[0]},this.getShadow=function(a){return this._readData(a,"shadows")[0]},this.getBackup=function(a){return this._readData(a,"backups")[0]},this._saveEdits=function(a){var b={id:a.id,clientId:a.clientId,edits:a.edits};return this._saveData(b,"edits"),b},this._getEdits=function(a){var b=this._readData(a,"edits");return b.length?b.edits:[]},this._removeEdit=function(a,b){var c,d,e,f=this._readData(a,"edits");for(c=0;c<f.length;c++)for(e=f[c],d=0;d<e.edits.length;d++)if(e.edits[d].serverVersion===b.serverVersion&&e.edits[d].clientVersion<=b.clientVersion){e.edits.splice(c,1);break}},this._removeEdits=function(a){var b=this._readData(a,"edits");b.splice(0,b.length)},this._restoreBackup=function(a,b){var c,d,e=this.getBackup(a.id);if(b.clientVersion===e.clientVersion)return d={id:e.id,clientVersion:e.clientVersion,content:e.content},c=this.applyEditsToShadow(b,d),d.serverVersion++,this._removeEdits(a.id),this._saveShadow(c);throw"Edit's clientVersion '"+b.clientVersion+"' does not match the backups clientVersion '"+e.clientVersion+"'"}},AeroGear.DiffSyncEngine.adapters.jsonPatch=function(){if(!(this instanceof AeroGear.DiffSyncEngine.adapters.jsonPatch))return new AeroGear.DiffSyncEngine.adapters.jsonPatch;var a={docs:[],shadows:[],backups:[],edits:[]};this.addDocument=function(a){this._saveDocument(JSON.parse(JSON.stringify(a))),this._saveShadow(JSON.parse(JSON.stringify(a))),this._saveShadowBackup(JSON.parse(JSON.stringify(a)),0)},this.diff=function(a){var b,c,d=this._readData(a.id,"shadows")[0];return b={msgType:"patch",id:a.id,clientId:d.clientId,edits:[{clientVersion:d.clientVersion,serverVersion:d.serverVersion,checksum:"",diffs:jsonpatch.compare(d.content,a.content)}]},d.clientVersion++,d.content=a.content,this._saveShadow(JSON.parse(JSON.stringify(d))),c=this._getEdits(a.id),c&&c.length>0&&(b.edits=c.concat(b.edits)),b},this.patch=function(a){var b=this.patchShadow(a);this.patchDocument(b),this._saveShadowBackup(b,b.clientVersion)
},this.patchShadow=function(a){var b,c,d=this.getShadow(a.id),e=a.edits;for(b=0;b<e.length;b++)c=e[b],c.clientVersion<d.clientVersion&&!this._isSeeded(c)?d=this._restoreBackup(d,c):c.serverVersion<d.serverVersion?this._removeEdit(a.id,c):(c.serverVersion===d.serverVersion&&c.clientVersion===d.clientVersion||this._isSeeded(c))&&(this.applyEditsToShadow(c,d),this._isSeeded(c)?d.clientVersion=0:c.clientVersion>=0&&d.serverVersion++,this._saveShadow(d),this._removeEdit(a.id,c));return d},this._isSeeded=function(a){return-1===a.clientVersion},this.applyEditsToShadow=function(a,b){var c;return c=jsonpatch.apply(b.content,a.diffs),b},this.patchDocument=function(a){var b,c,d;return b=this.getDocument(a.id),c=jsonpatch.compare(b.content,a.content),d=jsonpatch.apply(b.content,c),this._saveDocument(b),d},this._saveData=function(b,c){b=Array.isArray(b)?b:[b],a[c]=b},this._readData=function(b,c){return a[c].filter(function(a){return a.id===b})},this._saveDocument=function(a){return this._saveData(a,"docs"),a},this._saveShadow=function(a){var b={id:a.id,serverVersion:a.serverVersion||0,clientId:a.clientId,clientVersion:a.clientVersion||0,content:a.content};return this._saveData(b,"shadows"),b},this._saveShadowBackup=function(a,b){var c={id:a.id,clientVersion:b,content:a.content};return this._saveData(c,"backups"),c},this.getDocument=function(a){return this._readData(a,"docs")[0]},this.getShadow=function(a){return this._readData(a,"shadows")[0]},this.getBackup=function(a){return this._readData(a,"backups")[0]},this._saveEdits=function(a){var b={id:a.id,clientId:a.clientId,edits:a.edits};return this._saveData(b,"edits"),b},this._getEdits=function(a){var b=this._readData(a,"edits");return b.length?b.edits:[]},this._removeEdit=function(a,b){var c,d,e,f=this._readData(a,"edits");for(c=0;c<f.length;c++)for(e=f[c],d=0;d<e.edits.length;d++)if(e.edits[d].clientVersion<=b.clientVersion){e.edits.splice(c,1);break}},this._removeEdits=function(a){var b=this._readData(a,"edits");b.splice(0,b.length)},this._restoreBackup=function(a,b){var c,d,e=this.getBackup(a.id);if(b.clientVersion===e.clientVersion)return d={id:e.id,clientVersion:e.clientVersion,content:e.content},c=this.applyEditsToShadow(b,d),d.serverVersion++,this._removeEdits(a.id),this._saveShadow(c);throw"Edit's clientVersion '"+b.clientVersion+"' does not match the backups clientVersion '"+e.clientVersion+"'"}},AeroGear.DiffSyncClient=function(a){if(!(this instanceof AeroGear.DiffSyncClient))return new AeroGear.DiffSyncClient(a);a=a||{};var c,d=[],e=this,f=a.syncEngine||new AeroGear.DiffSyncEngine;if(a.serverUrl===b)throw new Error("'config.serverUrl' must be specified");this.connect=function(){c=new WebSocket(a.serverUrl),c.onopen=function(){for(a.onopen&&a.onopen.apply(this,arguments);d.length;){var b=d.pop();"add"===b.type?g(b.type,b.msg):e.sendEdits(b.msg)}},c.onmessage=function(b){var c,d;try{c=JSON.parse(b.data)}catch(f){c={}}c&&e._patch(c),d=e.getDocument(c.id),a.onsync&&a.onsync.call(this,d,b)},c.onerror=function(){a.onerror&&a.onerror.apply(this,arguments)},c.onclose=function(){a.onclose&&a.onclose.apply(this,arguments)}},this.connect(),this.disconnect=function(){c.close()},this._patch=function(a){f.patch(a)},this.getDocument=function(a){return f.getDocument(a)},this._diff=function(a){return f.diff(a)},this.addDocument=function(a){f.addDocument(a),0===c.readyState?d.push({type:"add",msg:a}):1===c.readyState&&g("add",a)},this._sendEdits=function(a){if(c.readyState===WebSocket.OPEN)c.send(JSON.stringify(a));else if(0===d.length)d.push({type:"patch",msg:a});else{for(var b=!1,e=0;e<d.length;e++){var f=d[e];if("patch"===f.type&&f.msg.clientId===a.clientId&&f.msg.id===a.id){for(var g=0;g<a.edits.length;g++)f.msg.edits.push(a.edits[g]);b=!0}}b||d.push({type:"patch",msg:a})}},this.sync=function(a){var b=e._diff(a);e._sendEdits(b)},this.removeDoc=function(){throw new Error("Method Not Yet Implemented")},this.fetch=function(a){var b,c;if(0===d.length)b=f.getDocument(a),e.sync(b);else for(;d.length;)c=d.shift(),"add"===c.type?g(c.type,c.msg):e._sendEdits(c.msg)};var g=function(a,b){var d={msgType:a,id:b.id,clientId:b.clientId,content:b.content};c.send(JSON.stringify(d))}}}(this);
//# sourceMappingURL=aerogear.min.js.map